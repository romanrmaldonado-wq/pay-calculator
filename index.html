<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pay Period Calculator</title>
    <meta name="description" content="Track appointments, estimates, and calculate pay bonuses">
    <meta name="theme-color" content="#198754">
    
    <!-- PWA Support -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    
    <style>
        .tables-wrapper {
            display: flex;
            flex-wrap: wrap; 
            gap: 20px;
        }
        .tables-wrapper table {
            flex: 1 1 100%; 
        }
        th {
            width: 100px;
        }
        @media (min-width: 768px) {
            .tables-wrapper table {
                flex: 1 1 calc(50% - 20px); 
            }
        }
        .th-input {
            width: 100%; 
            height: 30px; 
            box-sizing: border-box; 
            text-align: center;
        }
        .card-body h1 {
            font-size: 38px;
            font-weight: bold;
            color: #198754;
        }
        .table-container {
            max-width: 100%; 
            height: auto;
        }
        .grand-totals {
            background-color: #FFFF8F;
            padding: 10px;
            border-radius: 5px;
        }
        @media (max-width: 768px) {
            .table {
                width: 100%; 
                table-layout: fixed; 
            }
            .table th, .table td {
                word-wrap: break-word;
                padding: 7px; 
                font-size: 10px;
            }
            .th-input {
                width: 27px; 
                height: 25px; 
                font-size: 10px;
                box-sizing: border-box; 
            }
            #card_1 {
                margin-top: 0 !important;
            }
            .card-body h1 {
                font-size: 30px;
                font-weight: bold;
                color: #198754;
            }
        }
        
        /* Clear button styling */
        .btn-clear {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        /* Row labels */
        .row-label {
            font-size: 10px;
            color: #fff;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            padding: 2px;
        }
        
        @media (max-width: 768px) {
            .row-label {
                font-size: 8px;
            }
        }
    </style>
</head>
<body>
    
    <div class="container-fluid mt-2">
        <form id="jms_pay_period_calc_form" name="jms_pay_period_calc_form">
            <div style="display: flex; gap: 20px;" class="tables-wrapper">
                <!-- Week 1 Table -->
                <table class="table table-bordered border-dark tbl-1">
                    <tr>
                        <th colspan="9" class="bg-dark text-success small text-center">Week 1</th>
                    </tr>
                    <tr class="text-dark text-center">
                        <th class="bg-dark"></th>
                        <th class="bg-dark text-success small">M</th>
                        <th class="bg-dark text-success small">T</th>
                        <th class="bg-dark text-success small">W</th>
                        <th class="bg-dark text-success small">T</th>
                        <th class="bg-dark text-success small">F</th>
                        <th class="bg-dark text-success small">S</th>
                        <th class="bg-dark text-success small">S</th>
                        <th class="bg-dark text-success small">Total</th>
                    </tr>
                    <tr>
                        <th class="bg-dark text-light small row-label">Appts</th>
                        <th class="bg-primary"><input type="number" class="th-input" id="mon_w1_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="tue_w1_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="wed_w1_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="thu_w1_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="fri_w1_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-secondary"><input type="number" class="th-input" id="sat_w1_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-secondary"><input type="number" class="th-input" id="sun_w1_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-dark text-success text-center" id="w1_first_row_total">0</th>
                    </tr>
                    <tr>
                        <th class="bg-dark text-light small row-label">Ests</th>
                        <th class="bg-primary"><input type="number" class="th-input" id="mon_w1_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="tue_w1_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="wed_w1_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="thu_w1_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="fri_w1_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-secondary"><input type="number" class="th-input" id="sat_w1_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-secondary"><input type="number" class="th-input" id="sun_w1_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-dark text-success text-center" id="w1_second_row_total">0</th>
                    </tr>
                </table>
            
                <!-- Week 2 Table -->
                <table class="table table-bordered border-dark tbl-2">
                    <tr>
                        <th colspan="9" class="bg-dark text-success small text-center">Week 2</th>
                    </tr>
                    <tr class="text-dark text-center">
                        <th class="bg-dark"></th>
                        <th class="bg-dark text-success small">M</th>
                        <th class="bg-dark text-success small">T</th>
                        <th class="bg-dark text-success small">W</th>
                        <th class="bg-dark text-success small">T</th>
                        <th class="bg-dark text-success small">F</th>
                        <th class="bg-dark text-success small">S</th>
                        <th class="bg-dark text-success small">S</th>
                        <th class="bg-dark text-success small">Total</th>
                    </tr>
                    <tr>
                        <th class="bg-dark text-light small row-label">Appts</th>
                        <th class="bg-primary"><input type="number" class="th-input" id="mon_w2_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="tue_w2_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="wed_w2_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="thu_w2_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="fri_w2_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-secondary"><input type="number" class="th-input" id="sat_w2_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-secondary"><input type="number" class="th-input" id="sun_w2_user_input_first_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-dark text-success text-center" id="w2_first_row_total">0</th>
                    </tr>
                    <tr>
                        <th class="bg-dark text-light small row-label">Ests</th>
                        <th class="bg-primary"><input type="number" class="th-input" id="mon_w2_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="tue_w2_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="wed_w2_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="thu_w2_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-primary"><input type="number" class="th-input" id="fri_w2_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-secondary"><input type="number" class="th-input" id="sat_w2_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-secondary"><input type="number" class="th-input" id="sun_w2_user_input_second_row" value="0" min="0" inputmode="numeric"></th>
                        <th class="bg-dark text-success text-center" id="w2_second_row_total">0</th>
                    </tr>
                </table>

                <div class="container-fluid d-flex justify-content-center align-items-center">
                    <div class="row w-100">
                        <!-- Table Section -->
                        <div class="col-12 col-md-6">
                            <div class="card mt-4 p-3" id="card_1">
                                <div class="table-responsive">
                                    <table class="table table-bordered border-dark tbl-3">
                                        <thead>
                                            <tr class="text-dark text-center">
                                                <th class="text-success">Hours Worked</th>
                                                <th class="text-success">Total Estimates</th>
                                                <th class="text-success">Commission</th>
                                                <th class="text-success">Combined</th>
                                                <th class="text-success">Appointment Bonus</th>
                                                <th class="text-success">Base Pay</th>
                                            </tr>
                                            <tr>
                                                <th>
                                                    <input type="number" class="form-control text-dark text-center" value="0" id="hours_worked_count_total" min="0" step="0.5" inputmode="decimal">
                                                </th>
                                                <th>
                                                    <input type="text" class="form-control text-dark text-center" value="0" id="total_estimates_count_total" readonly>
                                                </th>
                                                <th>
                                                    <input type="text" class="form-control text-dark text-center" value="$0" id="commission_total_count" readonly>
                                                </th>
                                                <th>
                                                    <input type="text" class="form-control text-dark text-center" value="$0" id="combined_total_count" readonly>
                                                </th>
                                                <th>
                                                    <input type="text" class="form-control text-dark text-center" value="$0" id="appointment_bonus_total_count" readonly>
                                                </th>
                                                <th>
                                                    <input type="text" class="form-control text-dark text-center" value="$0" id="base_pay_total_count" readonly>
                                                </th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Total Section -->
                        <div class="col-12 col-md-6 mb-4 mb-md-0">
                            <div class="card mt-4 p-3">
                                <div class="card-body text-center">
                                    <h1>TOTAL</h1>
                                    <h1 id="grand_totals" class="grand-totals">$0.00</h1>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Clear Button -->
    <button class="btn btn-danger btn-clear" onclick="clearAll()" title="Clear All">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
            <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/>
        </svg>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <script>
        // Constants
        const BASE_PAY_RATE = 15.49;

        // Calculation functions (converted from PHP)
        function calculateDailyAppointmentValue(value) {
            if (value >= 10) return 500;
            if (value === 9) return 350;
            if (value === 8) return 250;
            if (value === 7) return 200;
            if (value === 6) return 150;
            if (value === 5) return 100;
            if (value >= 4) return 50;
            if (value === 3) return 25;
            return 0;
        }

        function calculateWeeklyAppointmentBonus(weeklyTotal) {
            if (weeklyTotal >= 40) return 500;
            if (weeklyTotal >= 35) return 400;
            if (weeklyTotal >= 30) return 300;
            if (weeklyTotal >= 25) return 200;
            if (weeklyTotal >= 20) return 150;
            if (weeklyTotal >= 15) return 100;
            return 0;
        }

        function calculateWeekAppointmentSum(dailyValues, weeklyTotal) {
            let sum = 0;
            for (let i = 0; i < dailyValues.length; i++) {
                sum += calculateDailyAppointmentValue(dailyValues[i]);
            }
            sum += calculateWeeklyAppointmentBonus(weeklyTotal);
            return sum;
        }

        function calculateEstimateBonus(weeklyEstimates) {
            if (weeklyEstimates >= 7) return 500;
            if (weeklyEstimates === 6) return 400;
            if (weeklyEstimates === 5) return 300;
            if (weeklyEstimates === 4) return 200;
            return 0;
        }

        function calculateCommission(totalEstimates) {
            if (totalEstimates >= 6) {
                return (totalEstimates - 5) * 200;
            }
            return 0;
        }

        // Get input value helper
        function getVal(id) {
            const el = document.getElementById(id);
            return el ? parseFloat(el.value) || 0 : 0;
        }

        // Main calculation function
        function calculate() {
            // Week 1 First Row (Appointments)
            const w1Appts = [
                getVal('mon_w1_user_input_first_row'),
                getVal('tue_w1_user_input_first_row'),
                getVal('wed_w1_user_input_first_row'),
                getVal('thu_w1_user_input_first_row'),
                getVal('fri_w1_user_input_first_row'),
                getVal('sat_w1_user_input_first_row'),
                getVal('sun_w1_user_input_first_row')
            ];
            const w1ApptsTotal = w1Appts.reduce((a, b) => a + b, 0);

            // Week 1 Second Row (Estimates)
            const w1Ests = [
                getVal('mon_w1_user_input_second_row'),
                getVal('tue_w1_user_input_second_row'),
                getVal('wed_w1_user_input_second_row'),
                getVal('thu_w1_user_input_second_row'),
                getVal('fri_w1_user_input_second_row'),
                getVal('sat_w1_user_input_second_row'),
                getVal('sun_w1_user_input_second_row')
            ];
            const w1EstsTotal = w1Ests.reduce((a, b) => a + b, 0);

            // Week 2 First Row (Appointments)
            const w2Appts = [
                getVal('mon_w2_user_input_first_row'),
                getVal('tue_w2_user_input_first_row'),
                getVal('wed_w2_user_input_first_row'),
                getVal('thu_w2_user_input_first_row'),
                getVal('fri_w2_user_input_first_row'),
                getVal('sat_w2_user_input_first_row'),
                getVal('sun_w2_user_input_first_row')
            ];
            const w2ApptsTotal = w2Appts.reduce((a, b) => a + b, 0);

            // Week 2 Second Row (Estimates)
            const w2Ests = [
                getVal('mon_w2_user_input_second_row'),
                getVal('tue_w2_user_input_second_row'),
                getVal('wed_w2_user_input_second_row'),
                getVal('thu_w2_user_input_second_row'),
                getVal('fri_w2_user_input_second_row'),
                getVal('sat_w2_user_input_second_row'),
                getVal('sun_w2_user_input_second_row')
            ];
            const w2EstsTotal = w2Ests.reduce((a, b) => a + b, 0);

            // Update row totals
            document.getElementById('w1_first_row_total').textContent = w1ApptsTotal;
            document.getElementById('w1_second_row_total').textContent = w1EstsTotal;
            document.getElementById('w2_first_row_total').textContent = w2ApptsTotal;
            document.getElementById('w2_second_row_total').textContent = w2EstsTotal;

            // Calculate bonuses
            const week1ApptBonus = calculateWeekAppointmentSum(w1Appts, w1ApptsTotal);
            const week2ApptBonus = calculateWeekAppointmentSum(w2Appts, w2ApptsTotal);
            const appointmentBonus = week1ApptBonus + week2ApptBonus;

            const week1EstBonus = calculateEstimateBonus(w1EstsTotal);
            const week2EstBonus = calculateEstimateBonus(w2EstsTotal);

            const totalEstimates = w1EstsTotal + w2EstsTotal;
            const commission = calculateCommission(totalEstimates);

            const combined = week1EstBonus + week2EstBonus + commission;

            const hoursWorked = getVal('hours_worked_count_total');
            const basePay = hoursWorked * BASE_PAY_RATE;

            const grandTotal = combined + appointmentBonus + basePay;

            // Update display
            document.getElementById('total_estimates_count_total').value = totalEstimates;
            document.getElementById('commission_total_count').value = '$' + commission;
            document.getElementById('combined_total_count').value = '$' + combined;
            document.getElementById('appointment_bonus_total_count').value = '$' + appointmentBonus;
            document.getElementById('base_pay_total_count').value = '$' + basePay.toFixed(2);
            document.getElementById('grand_totals').textContent = '$' + grandTotal.toFixed(2);

            // Save to localStorage
            saveData();
        }

        // Clear all inputs
        function clearAll() {
            if (confirm('Clear all data?')) {
                const inputs = document.querySelectorAll('input[type="number"]');
                inputs.forEach(input => input.value = 0);
                calculate();
                localStorage.removeItem('payPeriodData');
            }
        }

        // Save data to localStorage
        function saveData() {
            const data = {};
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                data[input.id] = input.value;
            });
            localStorage.setItem('payPeriodData', JSON.stringify(data));
        }

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('payPeriodData');
            if (saved) {
                const data = JSON.parse(saved);
                Object.keys(data).forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.value = data[id];
                });
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            calculate();

            // Add event listeners to all inputs
            const form = document.getElementById('jms_pay_period_calc_form');
            form.addEventListener('input', calculate);

            // Select all on focus for easier editing
            document.querySelectorAll('.th-input').forEach(input => {
                input.addEventListener('focus', function() {
                    this.select();
                });
            });
        });

        // Register service worker for PWA (optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js').catch(function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>
